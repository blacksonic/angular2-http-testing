{"version":3,"file":"fake-backend.js","sourceRoot":"","sources":["fake-backend.ts"],"names":[],"mappings":";;;;;;AAAA,iDAAoE;AACpE,sCAA6F;AAE7F,6DAAsF;AAEtF,6BAA6B,UAA0B;IACrD,MAAM,CAAC,UAAU,CAAC,UAAU,KAAK,iBAAU,CAAC,IAAI,CAAC;AACnD,CAAC;AAED;IAAiC,+BAAW;IAmB1C;QAAA,YACE,iBAAO,SASR;QA5BO,kBAAY,GAAqB,EAAE,CAAC;QACpC,mBAAa,GAAyB,EAAE,CAAC;QACzC,kBAAY,GAAG,IAAI,CAAC;QAmB1B,KAAI,CAAC,WAAW,CAAC,SAAS,CAAC,UAAC,UAA0B;YACpD,KAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAEnC,EAAE,CAAC,CAAC,KAAI,CAAC,YAAY,CAAC,CAAC,CAAC;gBACtB,KAAI,CAAC,kBAAkB,CAAC,KAAI,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;YACxD,CAAC;QACH,CAAC,CAAC,CAAC;;IACL,CAAC;IAxBa,wBAAY,GAA1B;QACE,MAAM,CAAC;YACL,WAAW;YACX,yBAAkB;YAClB;gBACE,OAAO,EAAE,WAAI;gBACb,UAAU,EAAE,UAAC,OAAoB,EAAE,cAAkC;oBACnE,MAAM,CAAC,IAAI,WAAI,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC;gBAC3C,CAAC;gBACD,IAAI,EAAE,CAAC,WAAW,EAAE,yBAAkB,CAAC;aACxC;SACF,CAAC;IACJ,CAAC;IAcM,oCAAc,GAArB,UAAsB,WAAoB;QACxC,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;IAClC,CAAC;IAEM,4BAAM,GAAb,UAAc,MAAqB,EAAE,GAAoB,EAAE,IAAsB,EAAE,OAA4C;QAC7H,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,QAAA;YACN,IAAI,MAAA;YACJ,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,+BAAS,GAAhB,UAAiB,GAAoB,EAAE,OAA4C;QACjF,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,GAAG;YACzB,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,gCAAU,GAAjB,UAAkB,GAAoB,EAAE,IAAsB,EAAE,OAA4C;QAC1G,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,IAAI;YAC1B,IAAI,MAAA;YACJ,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,+BAAS,GAAhB,UAAiB,GAAoB,EAAE,IAAsB,EAAE,OAA4C;QACzG,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,GAAG;YACzB,IAAI,MAAA;YACJ,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,kCAAY,GAAnB,UAAoB,GAAoB,EAAE,IAAsB,EAAE,OAA4C;QAC5G,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,MAAM;YAC5B,IAAI,MAAA;YACJ,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,iCAAW,GAAlB,UAAmB,GAAoB,EAAE,IAAsB,EAAE,OAA4C;QAC3G,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,KAAK;YAC3B,IAAI,MAAA;YACJ,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,gCAAU,GAAjB,UAAkB,GAAoB,EAAE,OAA4C;QAClF,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,IAAI;YAC1B,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,mCAAa,GAApB,UAAqB,GAAoB,EAAE,OAA4C;QACrF,MAAM,CAAC,IAAI,CAAC,eAAe,CAAC;YAC1B,GAAG,KAAA;YACH,MAAM,EAAE,oBAAa,CAAC,OAAO;YAC7B,OAAO,EAAE,IAAI,cAAO,CAAC,OAAO,CAAC;SAC9B,CAAC,CAAC;IACL,CAAC;IAEM,+BAAS,GAAhB;QACE,IAAI,sBAAsB,GAAG,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,mBAAmB,CAAC,CAAC;QAC9E,IAAI,CAAC,kBAAkB,CAAC,sBAAsB,CAAC,CAAC;IAClD,CAAC;IAEM,2BAAK,GAAZ;QAAA,iBAQC;QAPC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YACnC,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;QAC7C,CAAC;QAED,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,UAAC,UAAU,EAAE,KAAK;YAC1C,KAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,iDAA2B,GAAlC;QACE,IAAI,uBAAuB,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,UAAC,WAA+B,IAAK,OAAA,CAAC,WAAW,CAAC,aAAa,EAAE,EAA5B,CAA4B,CAAC,CAAC;QAE3H,EAAE,CAAC,CAAC,uBAAuB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YACvC,MAAM,IAAI,KAAK,CAAC,iCAA+B,uBAAuB,CAAC,MAAQ,CAAC,CAAC;QACnF,CAAC;IACH,CAAC;IAEM,6CAAuB,GAA9B;QACE,IAAI,sBAAsB,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,mBAAmB,CAAC,CAAC;QAE3E,EAAE,CAAC,CAAC,sBAAsB,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;YACtC,MAAM,IAAI,KAAK,CAAC,gCAA8B,sBAAsB,CAAC,MAAQ,CAAC,CAAC;QACjF,CAAC;IACH,CAAC;IAEO,qCAAe,GAAvB,UAAwB,OAAkC;QACxD,IAAI,WAAW,GAAG,IAAI,wCAAkB,CAAC,OAAO,CAAC,CAAC;QAClD,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACrC,MAAM,CAAC,WAAW,CAAC;IACrB,CAAC;IAEO,wCAAkB,GAA1B,UAA2B,KAAa;QACtC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC/B,MAAM,IAAI,KAAK,CAAC,2BAA2B,CAAC,CAAC;QAC/C,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,aAAa,EAAE,CAAC,CAAC,CAAC;YAC9C,MAAM,CAAC;QACT,CAAC;QAED,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC,MAAM,CAC9B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CACzB,CAAC;IACJ,CAAC;IACH,kBAAC;AAAD,CAAC,AA1JD,CAAiC,qBAAW,GA0J3C;AA1JY,kCAAW","sourcesContent":["import { MockBackend, MockConnection } from '@angular/http/testing';\nimport { Http, BaseRequestOptions, RequestMethod, Headers, ReadyState } from '@angular/http';\nimport { Provider } from '@angular/core';\nimport { BackendExpectation, BackendExpectationOptions } from './backend-expectation';\n\nfunction isConnectionPending(connection: MockConnection) {\n  return connection.readyState === ReadyState.Open;\n}\n\nexport class FakeBackend extends MockBackend {\n  private _connections: MockConnection[] = [];\n  private _expectations: BackendExpectation[] = [];\n  private _autoRespond = true;\n\n  public static getProviders(): Provider[] {\n    return [\n      FakeBackend,\n      BaseRequestOptions,\n      {\n        provide: Http,\n        useFactory: (backend: FakeBackend, defaultOptions: BaseRequestOptions) => {\n          return new Http(backend, defaultOptions);\n        },\n        deps: [FakeBackend, BaseRequestOptions]\n      }\n    ];\n  }\n\n  public constructor() {\n    super();\n\n    this.connections.subscribe((connection: MockConnection) => {\n      this._connections.push(connection);\n\n      if (this._autoRespond) {\n        this._verifyExpectation(this._connections.length - 1);\n      }\n    });\n  }\n\n  public setAutoRespond(autoRespond: boolean) {\n    this._autoRespond = autoRespond;\n  }\n\n  public expect(method: RequestMethod, url: string | RegExp, body?: string | Object, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method,\n      body,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectGet(url: string | RegExp, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Get,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectPost(url: string | RegExp, body?: string | Object, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Post,\n      body,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectPut(url: string | RegExp, body?: string | Object, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Put,\n      body,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectDelete(url: string | RegExp, body?: string | Object, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Delete,\n      body,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectPatch(url: string | RegExp, body?: string | Object, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Patch,\n      body,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectHead(url: string | RegExp, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Head,\n      headers: new Headers(headers)\n    });\n  }\n\n  public expectOptions(url: string | RegExp, headers?: Headers | { [name: string]: any; }) {\n    return this._addExpectation({\n      url,\n      method: RequestMethod.Options,\n      headers: new Headers(headers)\n    });\n  }\n\n  public flushNext() {\n    let pendingConnectionIndex = this._connections.findIndex(isConnectionPending);\n    this._verifyExpectation(pendingConnectionIndex);\n  }\n\n  public flush() {\n    if (this._connections.length === 0) {\n      throw new Error('No connections to flush');\n    }\n\n    this._connections.forEach((connection, order) => {\n      this._verifyExpectation(order);\n    });\n  }\n\n  public verifyNoPendingExpectations() {\n    let notVerifiedExpectations = this._expectations.filter((expectation: BackendExpectation) => !expectation.getIsVerified());\n\n    if (notVerifiedExpectations.length > 0) {\n      throw new Error(`Pending expectations found: ${notVerifiedExpectations.length}`);\n    }\n  }\n\n  public verifyNoPendingRequests() {\n    let notVerifiedConnections = this._connections.filter(isConnectionPending);\n\n    if (notVerifiedConnections.length > 0) {\n      throw new Error(`Pending connections found: ${notVerifiedConnections.length}`);\n    }\n  }\n\n  private _addExpectation(options: BackendExpectationOptions) {\n    let expectation = new BackendExpectation(options);\n    this._expectations.push(expectation);\n    return expectation;\n  }\n\n  private _verifyExpectation(order: number) {\n    if (!this._expectations[order]) {\n      throw new Error('No expectation to fulfill');\n    }\n\n    if (this._expectations[order].getIsVerified()) {\n      return;\n    }\n\n    this._expectations[order].verify(\n      this._connections[order]\n    );\n  }\n}\n"]}